import{_ as k,r as i,c as J,e as d,b as s,f as p,g as I,a as h,d as r,w as C,k as j,v as U,t as D,l as c,s as P}from"./index-ByinR5q9.js";import{H as T}from"./Header-WQbM4sA5.js";import{C as A,F as B}from"./Card-5eaP5XeC.js";import{B as S}from"./Button--kJKo-mJ.js";import{u as R}from"./api-Cad0ROAR.js";/* empty css                                                               */const E={class:"container"},V={class:"page-header"},H={class:"upload-content"},q={class:"form-group"},G={class:"file-upload-container"},M={class:"file-upload-ui"},L={key:0,class:"file-preview"},$=["src"],z={key:1,class:"upload-placeholder"},K={class:"form-group"},Q={class:"form-group"},W={class:"form-submit"},X={__name:"UploadPage",setup(Y){const _=I(),v=i(null),u=i(null),n=i(""),a=i(!1),m=i(null);function w(){_.push("/")}function N(l){const e=l.target.files[0];if(e){const o=new FileReader;o.onload=t=>{m.value=t.target.result},o.readAsDataURL(e)}}function O(l){const e=l.target.files[0];if(e){const o=new FileReader;o.onload=function(t){n.value=t.target.result},o.readAsText(e)}}async function y(){if(!v.value.files[0]){c("请选择截图文件");return}if(!n.value&&!u.value.files[0]){c("请提供节点JSON数据（上传文件或粘贴内容）");return}try{a.value=!0;const l=new FormData;if(l.append("screenshot",v.value.files[0]),n.value)try{const o=JSON.parse(n.value);console.log("解析的JSON数据格式验证：",Object.keys(o).join(",")),o.bounds||console.warn("警告：JSON数据可能缺少bounds字段"),l.append("nodeJson",n.value)}catch(o){console.error("JSON解析错误:",o),c("节点JSON格式无效，请检查"),a.value=!1;return}else if(u.value.files[0]){const o=u.value.files[0],t=new FileReader;try{const f=await new Promise((F,x)=>{t.onload=g=>F(g.target.result),t.onerror=g=>x(g),t.readAsText(o)}),b=JSON.parse(f);console.log("解析的JSON文件格式验证：",Object.keys(b).join(",")),b.bounds||console.warn("警告：JSON数据可能缺少bounds字段"),l.append("nodeJson",f)}catch(f){console.error("JSON文件解析错误:",f),c("节点JSON文件格式无效，请检查"),a.value=!1;return}}console.log("开始上传截图和节点数据");const e=await R(l);if(e&&e.screenshot_id){console.log("上传成功，截图ID:",e.screenshot_id);const o=e.screenshot_id;P("截图上传成功！",{duration:2500,onClose:()=>{console.log("Toast已关闭，准备跳转到详情页"),_.push(`/detail/${o}`)}})}else console.error("上传成功但未返回screenshot_id"),c("上传成功但返回数据不完整")}catch(l){console.error("上传过程出错:",l)}finally{a.value=!1}}return(l,e)=>(h(),J("div",E,[d(T),s("div",V,[e[2]||(e[2]=s("div",{class:"header-title"},[s("h1",null,"上传Android截图"),s("p",{class:"header-description"},"上传截图和UI节点数据进行分析")],-1)),d(S,{type:"ghost",onClick:w,icon:"🔙"},{default:p(()=>e[1]||(e[1]=[r("返回列表")])),_:1})]),s("div",H,[d(A,null,{header:p(()=>e[3]||(e[3]=[s("h5",null,[s("span",{class:"card-icon"},"📤"),r(" 上传截图和节点信息")],-1)])),default:p(()=>[s("form",{onSubmit:C(y,["prevent"]),class:"upload-form"},[s("div",q,[e[5]||(e[5]=s("label",{for:"screenshotFile",class:"form-label"},[s("span",{class:"label-icon"},"📷"),r(" 截图文件 "),s("span",{class:"required-field"},"*")],-1)),s("div",G,[s("input",{type:"file",id:"screenshotFile",ref_key:"screenshotFileInput",ref:v,class:"file-input",accept:"image/*",required:"",onChange:N},null,544),s("div",M,[m.value?(h(),J("div",L,[s("img",{src:m.value,alt:"预览",class:"preview-image"},null,8,$)])):(h(),J("div",z,e[4]||(e[4]=[s("span",{class:"upload-icon"},"📱",-1),s("span",null,"点击或拖拽截图到此处",-1)])))])]),e[6]||(e[6]=s("div",{class:"form-text"},"支持PNG、JPG格式的Android设备截图",-1))]),s("div",K,[e[7]||(e[7]=s("label",{for:"nodeJsonFile",class:"form-label"},[s("span",{class:"label-icon"},"📄"),r(" 节点JSON文件 ")],-1)),s("input",{type:"file",id:"nodeJsonFile",ref_key:"nodeJsonFileInput",ref:u,class:"form-control",accept:".json",onChange:O},null,544),e[8]||(e[8]=s("div",{class:"form-text"},"选择包含UI节点信息的JSON文件",-1))]),s("div",Q,[e[9]||(e[9]=s("label",{for:"nodeJson",class:"form-label"},[s("span",{class:"label-icon"},"📝"),r(" 或直接粘贴节点JSON ")],-1)),j(s("textarea",{id:"nodeJson","onUpdate:modelValue":e[0]||(e[0]=o=>n.value=o),class:"form-control",rows:"8",placeholder:"粘贴节点JSON数据到这里"},null,512),[[U,n.value]]),e[10]||(e[10]=s("div",{class:"form-text"},"从开发者工具导出的UI节点JSON数据",-1))]),s("div",W,[d(S,{type:"primary",loading:a.value,disabled:a.value,icon:"📤",block:!0},{default:p(()=>[r(D(a.value?"上传中...":"上传截图"),1)]),_:1},8,["loading","disabled"])])],32)]),_:1})]),d(B)]))}},ae=k(X,[["__scopeId","data-v-bc6ee0ea"]]);export{ae as default};
